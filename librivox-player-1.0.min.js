(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.constructor=c;c.extend=arguments.callee;return c}})();var LibLib={};LibLib.httpRequest=function(b,c,a){LibLib.xmlhttp;if(window.XMLHttpRequest){LibLib.xmlhttp=new XMLHttpRequest()}else{LibLib.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}LibLib.xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){c(LibLib.xmlhttp.responseXML.documentElement)}else{if(a!=null){a()}}};LibLib.xmlhttp.open("GET",b);LibLib.xmlhttp.send()};LibLib.abortRequest=function(){if(LibLib.xmlhttp!=null){LibLib.xmlhttp.abort()}};LibLib.Chapter=Class.extend({init:function(c,b,a){this.title=c;this.link=b;this.bookTitle=a}});LibLib.Book=Class.extend({init:function(e,d,c,a,b){this.id=e;this.title=d;this.category=c;this.genre=a;this.rssurl=b;this.chapters=[]},getChapterCount:function(){return this.chapters.length},getChapter:function(a){return this.chapters[a]},loadChapters:function(c,b){var a=this;callback=function(){if(b!=null){b()}};LibLib.httpRequest(this.rssurl,function(h){var e=h.getElementsByTagName("item");var d=new Array(e.length);for(var f=0;f<e.length;f++){var j=e[f].getElementsByTagName("title")[0].firstChild.nodeValue;var g=e[f].getElementsByTagName("link")[0].firstChild.nodeValue;d[f]=new LibLib.Chapter(j,g)}a.chapters=d;c()},callback())}});LibLib.Search=function(b,a,d){var c="http://librivox.org/newcatalog/search_xml.php?extended=1&";switch(b){case"simple":c+="simple="+a;break;case"genre":c+="genre="+a}LibLib.httpRequest(c,function(n){var l=n.getElementsByTagName("book");var h=new Array(l.length);for(var j=0;j<l.length;j++){var f=l[j].getElementsByTagName("id")[0].firstChild.nodeValue;var m=l[j].getElementsByTagName("title")[0].firstChild.nodeValue;var g=l[j].getElementsByTagName("Category")[0].firstChild.nodeValue;var k=l[j].getElementsByTagName("Genre")[0].firstChild.nodeValue;var e=l[j].getElementsByTagName("rssurl")[0].firstChild.nodeValue;h[j]=new LibLib.Book(f,m,g,k,e)}d(h)})};LibLib.Player=Class.extend({init:function(a){this.audioElement=a},play:function(b){var a=this;var c=function(d){a.audioElement.removeEventListener("canplay",c,false);a.audioElement.currentTime=0;a.audioElement.play()};a.audioElement.addEventListener("canplay",c,false);a.audioElement.src=b.link},playAtPosition:function(c,a){var b=this;var d=function(e){b.audioElement.removeEventListener("canplay",d,false);b.audioElement.currentTime=a;b.audioElement.play()};b.audioElement.addEventListener("canplay",d,false);b.audioElement.src=c.link},pause:function(){this.audioElement.pause},paused:function(){return this.audioElement.paused},addListener:function(a,b){this.audioElement.addEventListener(a,b,false)}});LibLib.Queue=LibLib.Player.extend({lastSavedPosition:0,init:function(a){this._super(a);this.items=[];this.current=0;var b=this;this.audioElement.addEventListener("ended",function(){if(b.items.length>0&&b.items.length-1!=b.current){b.current++;b.play()}})},play:function(a){if(a!=null){this.clear();this.add(a);this.current=0}if(this.items.length>0){this._super(this.items[this.current])}},playAtPosition:function(a){if(a==null){this._super(this.items[this.current],this.lastSavedPosition)}if(this.items.length>0){this._super(this.items[this.current],a)}},add:function(b){if(b instanceof LibLib.Book){for(var a=0;a<b.chapters.length;a++){this.items.push(b.chapters[a])}}else{if(b instanceof LibLib.Chapter){this.items.push(b)}}},clear:function(){this.items=[]},getCurrent:function(){return this.items[this.current]},savePosition:function(){this.lastSavedPosition=this.audioElement.currentTime}});